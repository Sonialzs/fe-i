---
title: 'åŸå‹é“¾'
slug: 'prototype-chain'
date: '2020-11-25'
category: 'JavaScript'
index: 10
authors:
    - cuvii
authorsUrl:
    - https://fei.kodin.fun
draft: false
---

æ¶‰åŠçŸ¥è¯†ç‚¹ï¼š

-   `new`
-   `constructor`
-   `prototype`
-   `__proto__`
-   åŸå‹é“¾

## æ„é€ å‡½æ•°

> Each constructor is a function that has a property named "prototype" that is used to implement prototype-based inheritance and shared properties.
>
> æ„é€ å‡½æ•°æ˜¯ä¸€ä¸ªæœ‰ prototype å±æ€§çš„å‡½æ•°ï¼Œprototype å±æ€§å¯ä»¥ç”¨æ¥å®ç°åŸºäºåŸå‹çš„ç»§æ‰¿å’Œè¿›è¡Œå±æ€§å…±äº«ã€‚
>
> [ECMA-262 4.2.1 Objects](https://www.ecma-international.org/ecma-262/11.0/index.html#sec-objects)

åœ¨[åˆ›å»ºå¯¹è±¡](/js/wtf/objects-creation)ä¸­ï¼Œæœ‰æåˆ°è¿‡å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æ¥åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚

å…ˆä¸ç®¡æ„é€ å‡½æ•°ï¼Œçœ‹çœ‹é€šè¿‡å·¥å‚å‡½æ•°åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä¾‹å­ã€‚

```js run
function Book(name) {
	const result = {};
	result.name = name;
	return result;
}

const book1 = Book('ä¸‰å›½æ¼”ä¹‰');
```

å¦‚æœé€šè¿‡æ„é€ å‡½æ•°æ”¹å†™ï¼Œé‚£ä¹ˆä»£ç ä¼šç®€å•ä¸€äº›ï¼š

```js run
function Movie(name) {
	this.name = name;
}

const movie1 = new Movie('é“äºº');
```

å›é¡¾ä¸€ä¸‹ï¼Œé€šè¿‡ new å…³é”®å­—è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šè‡ªåŠ¨åšä»¥ä¸‹å‡ ä»¶äº‹ï¼š

1. åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ã€‚
2. å°†å‡½æ•°å†…çš„ this æŒ‡å‘ç©ºå¯¹è±¡ã€‚
3. æ‰§è¡Œå‡½æ•°å†…éƒ¨çš„ä»£ç ã€‚
4. å¦‚æœå‡½æ•°æ²¡æœ‰è®¾ç½®è¿”å›å€¼ï¼Œå°±è¿”å›ç¬¬ä¸€æ­¥åˆ›å»ºçš„å¯¹è±¡ã€‚

å…¶å®åœ¨ç¬¬äºŒæ­¥ä¹‹å‰ï¼Œè¿˜ä¼šä¸ºç©ºå¯¹è±¡è®¾ç½®åŸå‹ï¼Œåœ¨ä¸Šé¢ä¾‹å­ä¸­å°±æ˜¯`movie1.__proto__ = Movie.prototype`ã€‚

å®é™…ä¸Šï¼Œæ„é€ å‡½æ•°æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œè®©å®ƒå’Œæ™®é€šå‡½æ•°äº§ç”ŸåŒºåˆ«çš„åŸå› åœ¨äºè°ƒç”¨æ–¹å¼ã€‚

-   é€šè¿‡`new`è°ƒç”¨ï¼Œå®ƒå°±æ˜¯æ„é€ å‡½æ•°ï¼ŒJavaScript ä¼šè‡ªåŠ¨å¤„ç†ä¸Šé¢æåˆ°çš„ 5 ä»¶äº‹ã€‚ä¾‹å¦‚ç¬¬äºŒä¸ªä»£ç ç‰‡æ®µä¸­ï¼Œmovie1 çš„åŸå‹è¢«è®¾ç½®ä¸º`Movei.prototype`ã€‚
-   ç›´æ¥è°ƒç”¨ï¼Œé‚£å®ƒå°±æ˜¯ä¸ªæ™®é€šå‡½æ•°ã€‚

## `prototype` å’Œ`__proto__`

åœ¨ Chrome æµè§ˆå™¨è°ƒè¯•å·¥å…·ä¸­ï¼Œè¾“å…¥ `console.dir(Movie)`å¯ä»¥çœ‹åˆ°ï¼Œ`Movie` å‡½æ•°ä¸Šæœ‰ä»¥ä¸‹è¿™äº›å±æ€§ã€‚

> éœ€è¦å…ˆåœ¨è°ƒè¯•å·¥å…·ä¸­åˆ›å»º Movie å‡½æ•°

```js
// console.dir(Movie)
arguments: null
caller: null
length: 1
name: "Movie"
prototype: {constructor: Æ’}
__proto__: Æ’ ()
[[FunctionLocation]]: VM1677:1
[[Scopes]]: Scopes[2]
```

å¯ä»¥çœ‹åˆ° Movie å‡½æ•°æ˜¯æœ‰ä¸€ä¸ª prototype å±æ€§çš„ã€‚ç»§ç»­å±•å¼€ prototype å±æ€§ã€‚

```js run
// Movie.prototype
constructor: Æ’ Movie(name)
__proto__: Object
```

å¯ä»¥çœ‹åˆ°`Moive.prototype`æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæœ‰`constructor`å’Œ`__proto__`ä¸¤ä¸ªå±æ€§ã€‚

åœ¨ JavaScript ä¸­ï¼Œ**æ¯ä¸ªå‡½æ•°éƒ½ä¼šæœ‰ä¸€ä¸ª `prototype` å±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ã€‚**

è€Œæ¯ä¸ªå¯¹è±¡éƒ½ä¼šæœ‰`__proto__`å±æ€§ã€‚

## å…³ç³»æ¢³ç†

ECMA-262 è§„èŒƒä¸­ï¼Œå¯¹äºå‡½æ•°`prototype`å±æ€§çš„è§£é‡Šï¼ˆæˆ–è€…è¯´è§„èŒƒï¼‰æ˜¯ï¼šä¸€ä¸ªæä¾›äº†å…±äº«å±æ€§çš„å¯¹è±¡ã€‚

> When a constructor creates an object, that object implicitly references the constructor's "prototype" property for the purpose of resolving property references. The constructor's "prototype" property can be referenced by the program expression constructor.prototype, and properties added to an object's prototype are shared, through inheritance, by all objects sharing the prototype. Alternatively, a new object may be created with an explicitly specified prototype by using the Object.create built-in function.
>
> [ECMA262 4.3.5 prototype](https://www.ecma-international.org/ecma-262/11.0/index.html#sec-terms-and-definitions-prototype)
>
> ---
>
> å½“é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡æ—¶ï¼Œæ–°å¯¹è±¡ä¼š(éšå¼)å¼•ç”¨æ„é€ å‡½æ•°çš„`prototype`å±æ€§ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥è§£å†³å±æ€§å¼•ç”¨(å…±äº«)é—®é¢˜ã€‚
> æ„é€ å‡½æ•°çš„`prototype`å±æ€§å¯ä»¥é€šè¿‡`constructor.prototype`è®¿é—®ã€‚
> é€šè¿‡ç»§æ‰¿æœºåˆ¶ï¼Œå¯¹è±¡åŸå‹ä¸Šçš„å±æ€§éƒ½æ˜¯å…±äº«çš„ã€‚
> ä¹Ÿå¯ä»¥é€šè¿‡ Objec.create()æ–¹æ³•æ˜¾ç¤ºæŒ‡å®šå¯¹è±¡çš„åŸå‹ã€‚

æ‰€ä»¥ï¼Œæ„é€ å‡½æ•°-åŸå‹(`prototype`)-å¯¹è±¡ä¹‹é—´çš„å…³ç³»æ˜¯è¿™æ ·çš„ï¼š

-   æ„é€ å‡½æ•°æœ‰ä¸€ä¸ª`prototype`å±æ€§ã€‚å®é™…ä¸Š JavaScript ä¸­æ¯ä¸€ä¸ªå‡½æ•°éƒ½æœ‰ prototype å±æ€§ï¼Œå› ä¸ºæ¯ä¸ªå‡½æ•°éƒ½å¯ä»¥å½“åšæ„é€ å‡½æ•°ä½¿ç”¨ï¼š`new FunctionName()`ã€‚
-   `prototype`å±æ€§æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸Šçš„æ‰€æœ‰å±æ€§çš„æ˜¯*å…±äº«*çš„ã€‚
-   å¯¹è±¡ä¸Šæœ‰ä¸€ä¸ª`__proto__`å±æ€§ï¼ŒæŒ‡å‘å®ƒçš„æ„é€ å‡½æ•°çš„`prototype`ã€‚

## åŸå‹é“¾

> a prototype may have a non-null implicit reference to its prototype, and so on; this is called the prototype chain. When a reference is made to a property in an object, that reference is to the property of that name in the first object in the prototype chain that contains a property of that name. In other words, first the object mentioned directly is examined for such a property; if that object contains the named property, that is the property to which the reference refers; if that object does not contain the named property, the prototype for that object is examined next; and so on.
>
> [ECMA-262 4.2.1 Objects](https://www.ecma-international.org/ecma-262/11.0/index.html#sec-objects)

åŸå‹é“¾ç®€å•æ¦‚å†µå°±æ˜¯ï¼šä¸€ä¸ªåŸå‹å¯¹è±¡å¼•ç”¨ï¼ˆæˆ–è€…è¯´æŒ‡å‘ï¼‰å…¶ä»–åŸå‹å¯¹è±¡ã€‚

å› ä¸ºåŸå‹å¯¹è±¡ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæœ‰`__proto__`å±æ€§ã€‚

ä¸¾ä¸ªæ —å­ã€‚

```js run
function Music() {}

const music1 = new Music();

console.log(music1.toString()); // [object Object]
```

è¿™ä¸ªæ —å­ä¸­ï¼ŒæˆåŠŸè°ƒç”¨äº†`music1.toString()`ï¼Œä½†æ˜¯`music1`å¯¹è±¡å’Œ`Music`å‡½æ•°ä¸Šéƒ½æ²¡æœ‰è¿™ä¸ªæ–¹æ³•å•Šï¼Œå“ªæ¥çš„ï¼Ÿ

ç­”æ¡ˆæ˜¯ï¼šåŸå‹é“¾ã€‚å½“è®¿é—®å¯¹è±¡ä¸Šçš„å±æ€§æ—¶ï¼ŒJavaScript ä¼šæ ¹æ®å¯¹è±¡çš„åŸå‹é“¾è¿›è¡ŒæŸ¥æ‰¾ã€‚

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š

1. åœ¨ `music1` å¯¹è±¡ä¸Šæ‰¾ `toString()`æ–¹æ³•ã€‚ç”±äº `music1` æ˜¯ç©ºå¯¹è±¡ï¼Œæ²¡æœ‰ `toString()`æ–¹æ³•ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ã€‚
2. æ£€æŸ¥ `music1` æ˜¯å¦æœ‰`__proto__`å±æ€§ã€‚å¦‚æœæ²¡æœ‰å°±åœæ­¢æŸ¥æ‰¾ï¼ŒæŠ¥é”™`music1.toString is not a function`ã€‚å¦‚æœåªæ˜¯æŸ¥æ‰¾ music1 çš„æŸä¸ªå±æ€§ï¼Œè€Œä¸æ˜¯æ–¹æ³•è°ƒç”¨ï¼Œä¾‹å¦‚`music1.name`ï¼Œåˆ™æ˜¯è¿”å› undefinedã€‚å¦‚æœæœ‰`__proto__`å±æ€§ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ã€‚
3. `music1.__proto__`æ˜¯æŒ‡å‘`Music.prototype`ã€‚ç”±äº`Music.prototype`ä¹Ÿæ˜¯ä¸ªç©ºå¯¹è±¡ï¼Œæ²¡æœ‰`toString()`æ–¹æ³•ã€‚æ‰€ä»¥ç»§ç»­å»`Music.prototype.__proto__`æ‰¾ã€‚
4. `Music.prototype.__proto__`æŒ‡å‘çš„æ˜¯`Object.prototype`ï¼Œæœ‰ `toString()`æ–¹æ³•ï¼Œäºæ˜¯å°±è°ƒç”¨äº†ã€‚

è½¬æ¢æˆä»£ç å°±æ˜¯ï¼š

```js
music1.__proto__.__proto__.toString();
```

### å±æ€§é®è”½

å’Œä½œç”¨åŸŸç›¸ä¼¼ï¼ŒåŸå‹é“¾ä¹Ÿä¼šå‘ç”Ÿé®è”½ç°è±¡ã€‚

å…ˆä¸¾ä¸ªæ —å­ã€‚

```js run
function Music() {}
Music.prototype.toString = function () {
	console.log('æˆ‘æ˜¯Music');
};

const music1 = new Music();
music1.toString = function () {
	console.log('æˆ‘æ˜¯music1');
};

music1.toString();
```

ä¼šè¾“å‡º`æˆ‘æ˜¯music1`ã€‚

å› ä¸ºç›´æ¥åœ¨ `music1` ä¸Šæ‰¾åˆ°äº† `toString` å±æ€§ã€‚å¦‚æœ `music1` ä¸Šæ²¡æœ‰ `toString` å±æ€§ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨ `Music.prototype` ä¸Šçš„ `toString` æ–¹æ³•ï¼Œè¾“å‡º`æˆ‘æ˜¯Music`ã€‚

## å…¶ä»–æƒ…å†µ

### åŸå‹é“¾çš„é¡¶å±‚

å‰é¢æåˆ°è¿‡`Object.prototype`ã€‚

`Object.prototype` ä¼šå‡ºç°åœ¨æ‰€æœ‰å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚ä½†æ˜¯ `Object.prototype` çš„`__proto__`å±æ€§ä¸º `null`ã€‚

```js run
Object.prototype.__proto__ === null;
```

æ‰€ä»¥ä¸¥æ ¼æ¥è¯´ï¼Œ**åŸå‹é“¾çš„æœ€é¡¶å±‚æ˜¯ null**ã€‚

### åŸå‹å¯¹è±¡æŒ‡å‘é—®é¢˜

```js run
var A = function () {};
A.prototype.n = 1;
var b = new A();
A.prototype = {
	n: 2,
	m: 3,
};
var c = new A();

console.log(b.n);
console.log(b.m);

console.log(c.n);
console.log(c.m);

// ä½œè€…ï¼šjsliang
// é“¾æ¥ï¼šhttps://juejin.cn/post/6844903782229213197
// æ¥æºï¼šæ˜é‡‘
// è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
```

è¿™é“é¢˜çœ‹ä¸Šå»æ˜¯åŸå‹é“¾çš„é¢˜ç›®ï¼Œå®é™…ä¸Šä¸»è¦æ˜¯å¼•ç”¨å¯¹è±¡èµ‹å€¼é—®é¢˜ã€‚

å‡è®¾æœ€å¼€å§‹ A.prototype æŒ‡å‘çš„å¯¹è±¡åœ°å€ä¸º`X001`ã€‚

é‚£`var b = new A()`æ—¶ï¼Œç”±äºå¼•ç”¨å¯¹è±¡èµ‹å€¼çš„å…³ç³»ï¼Œ`b.__proto__`ä¹ŸæŒ‡å‘äº†`X001`ã€‚

éšååˆå°†å¦ä¸€ä¸ªå¯¹è±¡èµ‹å€¼ç»™ A.prototypeï¼Œæ­¤æ—¶ A.prototype æŒ‡å‘çš„å¯¹è±¡åœ°å€å¯èƒ½ä¸º`X002`ã€‚

è¦æ³¨æ„ä¸ç®¡`A.prototype`æŒ‡å‘è°ï¼Œ`b.__proto__`éƒ½æŒ‡å‘`X001`åœ°å€çš„å¯¹è±¡ã€‚

å½“æ‰§è¡Œ`var c = new A()`æ—¶ï¼Œ`c.__proto__`æŒ‡å‘`X002`ã€‚

> -   ğŸ”¥[å›¾è§£åŸå‹å’ŒåŸå‹é“¾ â€”â€” JS èŒ](https://juejin.cn/post/6844903797039300615)
> -   [åŸå‹ä¸åŸå‹é“¾ â€”â€” jsliang](https://juejin.cn/post/6890716797436166152)
> -   [js åŸå‹åŠåŸå‹é“¾ â€”â€” èœé¸¡å°å‰ç«¯](https://juejin.cn/post/6844904093828251662)
